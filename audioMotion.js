/*! For license information please see audioMotion.js.LICENSE.txt */
(()=>{var e,t={6965:(e,t,a)=>{"use strict";var n=a(4015);const o="/music",s="electron"in window,i=s&&/Windows/.test(navigator.userAgent),l=!!window.showDirectoryPicker,r="Click to open a new root folder",c="No music found on server and no browser support for File System API",d="loading",u=0;let f,p,h,m,b,g,v=[],y=/.*/,k=[],w=!1,x=!1,L=!1;function S(e,t){m.innerHTML="",b.innerHTML="",b.style.backgroundImage="";const a=(e,t)=>{const a=document.createElement("li"),n=e.name||e;a.dataset.type=null!==n.match(/\.(m3u|m3u8)$/)&&"file"==t?"list":t,a.dataset.path=n,a.innerText=n,a.handle=e.handle,b.append(a)},n=e=>b.style.backgroundImage="linear-gradient( #fff9 0%, #fff9 100% )"+(e?`, url('${e}')`:"");if(0==k.length&&(m.innerHTML=c),v.forEach((({dir:e},t)=>{m.innerHTML+=`<li data-depth="${v.length-t-1}">${e}</li> ${i?"\\":"/"==e?"":"/"} `})),k.forEach((e=>{b.innerHTML+=`<li data-type="mount" ${L&&!f?'class="full-panel"':""} data-path="${e}">[ ${e} ]</li>`})),v.length>1&&(b.innerHTML+='<li data-type="dir" data-path="..">[ parent folder ]</li>'),e){const{cover:t,dirs:o,files:s}=e;o&&o.forEach((e=>a(e,"dir"))),s&&s.forEach((e=>a(e,"file"))),t&&t.handle?t.handle.getFile().then((e=>n(URL.createObjectURL(e)))):n(t?$(t):"")}b.scrollTop=t||0}function E(e,t){let a,n=e&&"string"!=typeof e?e:null,o=f,s=[...v];if(n&&(e=n.name),e)if(".."==e){a=v.pop();const e=v[v.length-1];e&&e.handle&&(n=e.handle)}else v.push({dir:e,scrollTop:b.scrollTop,handle:n});return b.classList.add(d),new Promise((async e=>{const i=n=>{b.classList.remove(d),!1!==n?(w&&!L||(n=I(n)),S(n,t||a&&a.scrollTop),h&&h(v),e(!0)):(v=s,f=o,e(!1))};if(f){n&&(f=n);let e=[];try{for await(const t of f.entries())e.push(t)}catch(t){e=!1}i(e)}else{const e=$();fetch(e).then((e=>200==e.status&&(w?e.json():e.text()))).then((e=>i(e))).catch((()=>i(!1)))}}))}function C(e){return e.replace(/[#%&]/g,(e=>({"#":"%23","%":"%25","&":"%26"}[e])))}function $(e,t){let a="";return v.forEach((({dir:e})=>{a+=e+("/"==e?"":"/")})),e&&(a+=e),a=C(a),s?(a=a.replace(/\//g,"%2f"),t||(a=(e?"/getFile/":"/getDir/")+a)):g==u&&"/"==a[0]&&(a=a.slice(1)),a}function A(e="li"){let t=[];return b.querySelectorAll(e).forEach((e=>{["file","list"].includes(e.dataset.type)&&t.push({file:$(e.dataset.path),handle:e.handle,type:e.dataset.type})})),t}async function T(e){const t=[...v],a=e.split("/");let n=t[t.length-1].handle;for(;a.length>1;){const e=a.shift();".."==e?(t.pop(),n=t[t.length-1].handle):(n=await n.getDirectoryHandle(e),t.push({handle:n}))}return await n.getFileHandle(a.shift())}function P(e){const t=e.match(/href="[^"]*"[^>]*>[^<]*<\/a>/gi);let a=[];for(const e of t){const t=e.match(/href="([^"]*)"[^>]*>\s*([^<]*)<\/a>/i)[1],n="/"==t.slice(-1),o=t.slice(t.lastIndexOf("/",n?t.length-2:void 0)+1),s=decodeURIComponent(o.slice(0,n?-1:void 0));a.push({url:o,file:s})}return a}function I(e){const t=/\.(jpg|jpeg|webp|avif|png|gif|bmp)$/i;let a=[],n=[],o=[];const s=(e,a)=>{const n=new RegExp(`${a}.*${t.source}`,"i");return e.find((e=>(e.name||e).match(n)))};if(L)for(const[s,i]of e)i instanceof FileSystemDirectoryHandle?n.push({name:s,handle:i}):i instanceof FileSystemFileHandle&&(s.match(t)&&o.push({name:s,handle:i}),s.match(y)&&a.push({name:s,handle:i}));else for(const{url:s,file:i}of P(e))"/"==s.slice(-1)?i.match(/(parent directory|\.\.)/i)||n.push(i):(i.match(t)&&o.push(i),i.match(y)&&a.push(i));const i=(e,t)=>{const a="object"==typeof e;return(new Intl.Collator).compare(...a?[e.name,t.name]:[e,t])};return{cover:s(o,"cover")||s(o,"folder")||s(o,"front")||o[0],dirs:n.sort(i),files:a.sort(i)}}async function O(e){const t=e&&e[e.length-1],a=f,n=[...v];v=e,t&&t.handle&&(f=t.handle);const o=!!e&&await E();return o||(f=a,v=n,L||v.length?L&&!f&&S():E(k[0])),o}var R=a(6015),M=(a(6216),a(7783)),_=a(246),D=a(4596),F=a.n(D);_.Ay.mount(new _.cR);const B="electron"in window,q=B&&/Windows/.test(navigator.userAgent),H="/getFile/",N="/getCover/",j="/savePlist/",U=location.origin+location.pathname,z="24.4",W=B?"/getBackground":"backgrounds",K=4,G=2e3,Y="0",X="1",J="2",V="3",Z="4",Q="0",ee="1",te="2",ae="0",ne="1",oe="2",se="3",ie="6",le="7",re="8",ce={album:"",artist:"",codec:"",cover:"",duration:"",file:"",quality:"",title:""},de="dual-combined",ue="single",fe="gradient",pe="bar-index",he="bar-level",me=20,be=["mp3","flac","m4a","aac","ogg","wav"],ge=["jpg","jpeg","webp","avif","png","gif","bmp"],ve=["m3u","m3u8"],ye=["mkv","mpg","webm","mp4","avi","mov"],ke="local",we="bgDir",xe="custom-grads",Le="custom-preset",Se="disabled-bgfit",Ee="disabled-gradients",Ce="disabled-modes",$e="disabled-properties",Ae="display-options",Te="force-filesystem",Pe="general-settings",Ie="last-config",Oe="last-dir",Re="last-version",Me="playlists",_e="playqueue",De="sensitivity-presets",Fe="pl_",Be="10",qe="101",He="close",Ne="open",je="No description",Ue="1",ze="2",We="alpha",Ke="nobg",Ge="barSp",Ye="imgfit",Xe="stereo",Je="colormode",Ve="fill",Ze="gradient",Qe="leds",et="line",tt="lumi",at="mirror",nt="mode",ot="outline",st="peaks",it="presets",lt="radial",rt="spin",ct="reflex",dt="round",ut="split",ft="bark",pt="log",ht=1,mt=-1,bt="config.json",gt={defaultAccessMode:ke,enableLocalAccess:!0,mediaPanel:Ne},vt="show",yt="D",kt=832,wt=document.querySelector.bind(document),xt=document.querySelectorAll.bind(document),Lt=wt("#alpha_bars"),St=wt("#analyzer"),Et=wt("#ansi_bands"),Ct=wt("#auto_hide"),$t=wt("#background"),At=wt("#balance"),Tt=wt("#bar_space"),Pt=wt("#bg_img_dim"),It=wt("#bg_img_fit"),Ot=wt("#bg_location"),Rt=wt("#bg_max_items"),Mt=wt("#channel_layout"),_t=wt("#color_mode"),Dt=wt("#bg_container"),Ft=wt("#bg_dim"),Bt=wt("#end_timeout"),qt=wt("#fft_size"),Ht=wt("#fill_alpha"),Nt=wt("#fps"),jt=wt("#freq_scale"),Ut=wt("#fs_height"),zt=wt("#gradient"),Wt=wt("#gradientRight"),Kt=wt("#info_timeout"),Gt=wt("#led_display"),Yt=wt("#linear_amplitude"),Xt=wt("#line_width"),Jt=wt("#link_grads"),Vt=wt("#loaded_playlist"),Zt=wt("#lo_res"),Qt=wt("#lumi_bars"),ea=wt("#max_fps"),ta=wt("#files_panel"),aa=wt("#mirror"),na=wt("#mode"),oa=wt("#mute"),sa=wt("#no_shadow"),ia=wt("#note_labels"),la=wt("#outline"),ra=wt("#osd"),ca=wt("#osd_font_size"),da=wt("#pip_ratio"),ua=wt("#playlists"),fa=wt("#radial"),pa=wt("#random_mode"),ha=wt("#freq_max"),ma=wt("#freq_min"),ba=wt("#reflex"),ga=wt("#repeat"),va=wt("#round_bars"),ya=wt("#save_dir"),ka=wt("#save_queue"),wa=wt("#scaleX"),xa=wt("#scaleY"),La=wt("#sensitivity"),Sa=wt("#show_count"),Ea=wt("#show_cover"),Ca=wt("#show_peaks"),$a=wt("#show_song"),Aa=wt("#smoothing"),Ta=wt("#source"),Pa=wt("#spin"),Ia=wt("#split_grad"),Oa=wt("#toggle_console"),Ra=wt("#toggle_settings"),Ma=wt("#track_timeout"),_a=wt("#video"),Da=wt("#volume"),Fa=wt("#warp"),Ba=wt("#weighting"),qa=[{key:"demo",name:"Demo (random)",options:{randomMode:6}},{key:"bands",name:"Octave Bands",options:{alphaBars:0,ansiBands:0,background:J,barSpace:.25,bgImageDim:.3,bgImageFit:ae,channelLayout:ue,colorMode:fe,freqMax:2e4,freqMin:25,freqScale:pt,gradient:"rainbow",ledDisplay:0,linearAmpl:1,lumiBars:0,mirror:0,mode:"2",noteLabels:1,outlineBars:0,radial:0,randomMode:0,reflex:Ue,roundBars:0,showPeaks:1,showScaleX:1,showScaleY:0,showSong:1,splitGrad:0,weighting:yt}},{key:"ledbars",name:"Classic LED bars",options:{alphaBars:0,ansiBands:1,background:J,barSpace:.25,bgImageDim:.3,bgImageFit:ne,channelLayout:ue,colorMode:fe,freqMax:2e4,freqMin:25,freqScale:pt,gradient:"classic",ledDisplay:1,linearAmpl:1,lumiBars:0,outlineBars:0,mirror:0,mode:"6",noteLabels:0,radial:0,randomMode:0,reflex:"0",roundBars:0,showPeaks:1,showScaleX:1,showScaleY:0,showSong:1,splitGrad:0,weighting:yt}},{key:"dual",name:"Dual-channel combined Graph, Bark frequency scale",options:{ansiBands:0,background:J,bgImageDim:.3,bgImageFit:ne,channelLayout:de,colorMode:fe,fillAlpha:.3,freqMax:2e4,freqMin:20,freqScale:ft,gradient:"cool",gradientRight:"dusk",linearAmpl:1,lineWidth:1.5,linkGrads:0,mirror:0,mode:qe,noteLabels:0,radial:0,randomMode:0,reflex:"0",showPeaks:0,showScaleX:0,showScaleY:0,showSong:1,splitGrad:0,weighting:yt}},{key:"radial",name:"Radial Color by Level",options:{alphaBars:1,ansiBands:0,background:J,barSpace:.1,bgImageDim:.3,bgImageFit:se,channelLayout:ue,colorMode:he,freqMax:2e4,freqMin:20,freqScale:pt,gradient:"prism",ledDisplay:0,linearAmpl:1,lumiBars:0,mirror:0,mode:"5",noteLabels:0,outlineBars:0,radial:1,randomMode:0,showPeaks:1,showScaleX:1,showScaleY:0,showSong:1,spin:1,splitGrad:0,weighting:yt}},{key:"round",name:"Round Bars reflex",options:{alphaBars:0,background:J,barSpace:.25,bgImageDim:.3,bgImageFit:le,channelLayout:ue,colorMode:pe,freqMax:2e4,freqMin:20,freqScale:pt,gradient:"apple",ledDisplay:0,linearAmpl:1,lumiBars:0,mirror:0,mode:"3",noteLabels:0,outlineBars:0,radial:0,randomMode:0,reflex:ze,roundBars:1,showPeaks:0,showScaleX:0,showScaleY:0,showSong:1,splitGrad:0,weighting:yt}},{key:"last",name:"Last session",options:{}},{key:"default",name:"Restore defaults",options:{alphaBars:0,ansiBands:0,background:Y,balance:0,barSpace:.1,bgImageDim:.5,bgImageFit:ne,channelLayout:ue,colorMode:fe,fillAlpha:.1,freqMax:2e4,freqMin:20,freqScale:pt,gradient:"prism",gradientRight:"prism",ledDisplay:0,linearAmpl:0,lineWidth:2,linkGrads:0,loRes:0,lumiBars:0,micSource:0,mirror:0,mode:"0",mute:0,noShadow:1,noteLabels:0,outlineBars:0,radial:0,randomMode:0,reflex:"0",repeat:0,roundBars:0,sensitivity:1,showFPS:0,showPeaks:1,showScaleX:1,showScaleY:0,showSong:1,spin:2,splitGrad:0,volume:1,weighting:""}}],Ha={apple:{name:"Apple ][",colorStops:[{pos:.1667,color:"#61bb46"},{pos:.3333,color:"#fdb827"},{pos:.5,color:"#f5821f"},{pos:.6667,color:"#e03a3e"},{pos:.8333,color:"#963d97"},{pos:1,color:"#009ddc"}],disabled:!1},aurora:{name:"Aurora",bgColor:"#0e172a",colorStops:[{pos:.1,color:"hsl( 120, 100%, 50% )"},{pos:1,color:"hsl( 216, 100%, 50% )"}],disabled:!1},borealis:{name:"Borealis",bgColor:"#0d1526",colorStops:[{pos:.1,color:"hsl( 120, 100%, 50% )"},{pos:.5,color:"hsl( 189, 100%, 40% )"},{pos:1,color:"hsl( 290, 60%, 40% )"}],disabled:!1},candy:{name:"Candy",bgColor:"#0d0619",colorStops:[{pos:.1,color:"#ffaf7b"},{pos:.5,color:"#d76d77"},{pos:1,color:"#3a1c71"}],disabled:!1},classic:{name:"Classic",disabled:!1},cool:{name:"Cool",bgColor:"#0b202b",colorStops:["hsl( 208, 0%, 100% )","hsl( 208, 100%, 35% )"],disabled:!1},dusk:{name:"Dusk",bgColor:"#0e172a",colorStops:[{pos:.2,color:"hsl( 55, 100%, 50% )"},{pos:1,color:"hsl( 16, 100%, 50% )"}],disabled:!1},miami:{name:"Miami",bgColor:"#110a11",colorStops:[{pos:.024,color:"rgb( 251, 198, 6 )"},{pos:.283,color:"rgb( 224, 82, 95 )"},{pos:.462,color:"rgb( 194, 78, 154 )"},{pos:.794,color:"rgb( 32, 173, 190 )"},{pos:1,color:"rgb( 22, 158, 95 )"}],disabled:!1},orient:{name:"Orient",bgColor:"#100",colorStops:[{pos:.1,color:"#f00"},{pos:1,color:"#600"}],disabled:!1},outrun:{name:"Outrun",bgColor:"#101",colorStops:[{pos:0,color:"rgb( 255, 223, 67 )"},{pos:.182,color:"rgb( 250, 84, 118 )"},{pos:.364,color:"rgb( 198, 59, 243 )"},{pos:.525,color:"rgb( 133, 80, 255 )"},{pos:.688,color:"rgb( 74, 104, 247 )"},{pos:1,color:"rgb( 35, 210, 255 )"}],disabled:!1},pacific:{name:"Pacific Dream",bgColor:"#051319",colorStops:[{pos:.1,color:"#34e89e"},{pos:1,color:"#0f3443"}],disabled:!1},prism:{name:"Prism",disabled:!1},prism_old:{name:"Prism (legacy)",colorStops:["hsl( 0, 100%, 50% )","hsl( 60, 100%, 50% )","hsl( 120, 100%, 50% )","hsl( 180, 100%, 50% )","hsl( 240, 100%, 50% )"],disabled:!0},rainbow:{name:"Rainbow",disabled:!1},rainbow_old:{name:"Rainbow (legacy)",dir:"h",colorStops:["hsl( 0, 100%, 50% )","hsl( 60, 100%, 50% )","hsl( 120, 100%, 50% )","hsl( 180, 100%, 47% )","hsl( 240, 100%, 58% )","hsl( 300, 100%, 50% )","hsl( 360, 100%, 50% )"],disabled:!0},shahabi:{name:"Shahabi",bgColor:"#060613",colorStops:[{pos:.1,color:"#66ff00"},{pos:1,color:"#a80077"}],disabled:!1},summer:{name:"Summer",bgColor:"#041919",colorStops:[{pos:.1,color:"#fdbb2d"},{pos:1,color:"#22c1c3"}],disabled:!1},sunset:{name:"Sunset",bgColor:"#021119",colorStops:[{pos:.1,color:"#f56217"},{pos:1,color:"#0b486b"}],disabled:!1},tiedye:{name:"Tie Dye",colorStops:[{pos:.038,color:"rgb( 15, 209, 165 )"},{pos:.208,color:"rgb( 15, 157, 209 )"},{pos:.519,color:"rgb( 133, 13, 230 )"},{pos:.731,color:"rgb( 230, 13, 202 )"},{pos:.941,color:"rgb( 242, 180, 107 )"}],disabled:!1}},Na=[{value:"0",text:"Discrete frequencies",disabled:!1},{value:Be,text:"Area graph",disabled:!1},{value:qe,text:"Line graph",disabled:!1},{value:"8",text:"Octave bands / 10 bands",disabled:!1},{value:"7",text:"1/2 octave / 20 bands",disabled:!1},{value:"6",text:"1/3 octave / 30 bands",disabled:!1},{value:"5",text:"1/4 octave / 40 bands",disabled:!1},{value:"4",text:"1/6 octave / 60 bands",disabled:!1},{value:"3",text:"1/8 octave / 80 bands",disabled:!1},{value:"2",text:"1/12 octave / 120 bands",disabled:!1},{value:"1",text:"1/24 octave / 240 bands",disabled:!1}],ja=[[ue,"Singl"],[de,"Comb"],["dual-horizontal","Horiz"],["dual-vertical","Vert"]],Ua=[{value:We,text:"Alpha",disabled:!1},{value:nt,text:"Analyzer Mode",disabled:!1},{value:Ke,text:"Background",disabled:!1},{value:Ge,text:"Bar Spacing",disabled:!1},{value:Ye,text:"BG Image Fit",disabled:!1},{value:Xe,text:"Channel Layout",disabled:!1},{value:Je,text:"Color Mode",disabled:!1},{value:Ve,text:"Fill Opacity",disabled:!1},{value:Ze,text:"Gradients",disabled:!1},{value:Qe,text:"LEDs",disabled:!1},{value:et,text:"Line Width",disabled:!1},{value:tt,text:"Lumi",disabled:!1},{value:at,text:"Mirror",disabled:!1},{value:ot,text:"Outline",disabled:!1},{value:st,text:"Peaks",disabled:!1},{value:lt,text:"Radial",disabled:!1},{value:rt,text:"Radial Spin",disabled:!1},{value:ct,text:"Reflex",disabled:!1},{value:dt,text:"Round",disabled:!1},{value:ut,text:"Split",disabled:!1},{value:it,text:"User Presets",disabled:!0}],za=[{min:-70,max:-20,boost:1},{min:-85,max:-25,boost:1.6},{min:-100,max:-30,boost:2.4}],Wa={info:5,track:10,end:10,covers:!0,count:!0},Ka=[{value:ae,text:"Adjust",disabled:!1},{value:ne,text:"Center",disabled:!1},{value:se,text:"Pulse",disabled:!1},{value:oe,text:"Repeat",disabled:!1},{value:ie,text:"Warp",disabled:!1},{value:le,text:"Warp Drive",disabled:!1},{value:re,text:"Wormhole",disabled:!1},{value:"4",text:"Zoom In",disabled:!1},{value:"5",text:"Zoom Out",disabled:!1}],Ga=[Ct,Ot,Rt,qt,Ut,ea,ca,da,ya,ka,Aa],Ya={autoHide:!0,bgLocation:ee,bgMaxItems:20,fftSize:8192,osdFontSize:"1",fsHeight:100,maxFPS:60,pipRatio:2.35,saveDir:!0,saveQueue:!0,smoothing:.7},Xa=[[30,"30"],[60,"60"],[0,"unlimited"]],Ja=[[1,"1:1"],[1.33,"4:3"],[1.78,"16:9"],[2.35,"2.35:1"],[3.55,"32:9"]];let Va,Za,Qa,en,tn,an,nn,on,sn,ln,rn,cn,dn,un,fn,pn,hn,mn,bn,gn,vn,yn,kn,wn,xn,Ln,Sn,En,Cn,$n=[],An=[],Tn=[],Pn=null,In={},On=!1,Rn=!1,Mn=!1,_n=0;const Dn=ra.getContext("2d"),Fn=new Image,Bn=document.createElement("video"),qn=(e,t)=>e.replace(/(%2f|\/)/g,t&&q?"\\":"/"),Hn=e=>e.replace(/\//g,"%2f"),Nn=e=>Math.round(100*e)/100,jn=e=>{if(!e)return;let t=0;for(;e=e.previousElementSibling;)t++;return t},Un=e=>{let t="";if(Zn(e)){const a=e.querySelector(":checked ~ label");a&&(t=a.textContent)}else t=e[e.selectedIndex].text;return t},zn=e=>Zn(e)?e.elements[e.dataset.prop].value:void 0!==e.dataset.active?e.dataset.active:e.value,Wn=e=>({alphaBars:zn(Lt),ansiBands:zn(Et),background:zn($t),barSpace:zn(Tt),bgImageDim:zn(Pt),bgImageFit:zn(It),channelLayout:zn(Mt),colorMode:zn(_t),fillAlpha:zn(Ht),freqMax:zn(ha),freqMin:zn(ma),freqScale:zn(jt),gradient:zn(zt),gradientRight:zn(Wt),ledDisplay:zn(Gt),linearAmpl:zn(Yt),lineWidth:zn(Xt),linkGrads:zn(Jt),loRes:zn(Zt),lumiBars:zn(Qt),mirror:zn(aa),mode:zn(na),noShadow:zn(sa),noteLabels:zn(ia),outlineBars:zn(la),radial:zn(fa),randomMode:zn(pa),reflex:zn(ba),repeat:zn(ga),roundBars:zn(va),sensitivity:zn(La),showFPS:zn(Nt),showPeaks:zn(Ca),showScaleX:zn(wa),showScaleY:zn(xa),showSong:zn($a),spin:zn(Pa),splitGrad:zn(Ia),weighting:zn(Ba)}),Kn=e=>{const t=+e==e?e:qa.findIndex((t=>t.key==e));return t<0||t>qa.length-1?-1:t},Gn=e=>{const t=Kn(e);return-1==t?{}:qa[t].options},Yn=e=>{const t=Kn(e);return-1!=t&&qa[t].name},Xn=()=>{const e=zn(Mt)!=ue&&!no(Jt);return`Gradient${e?"s":""}: ${Ha[zt.value].name+(e?" / "+Ha[Wt.value].name:"")}`},Jn=()=>fn.map(((e,t)=>`<strong>[${t+1}]</strong>&nbsp; ${eo(e)?'<em class="empty">Empty slot</em>':e.name||je}`)),Vn=e=>e.startsWith("blob:"),Zn=e=>"FORM"==e.tagName&&null!=e.dataset.prop,Qn=e=>e.startsWith("http")&&!e.startsWith(U),eo=e=>!e||"object"!=typeof e||!Object.keys(e).length,to=e=>Dt.classList.contains("pip"),ao=(e=$n[Qa])=>e&&e.currentTime>0&&!e.paused&&!e.ended,no=e=>"1"==e.dataset.active,oo=()=>ye.includes(lo($n[Qa].dataset.file).extension),so=e=>"string"==typeof e?e.replace(/\\/g,"/"):e,io=e=>no(e)?"ON":"OFF",lo=e=>{if("string"!=typeof e)return{};const t=po(e),a=t.lastIndexOf("/")+1,n=t.slice(0,a),o=t.slice(a),s=o.lastIndexOf("."),i=s>=0?o.slice(0,s):o,l=s>=0?o.slice(s+1).toLowerCase():"";return{path:n,fileName:o,baseName:i,extension:l}},ro=e=>{const t=/\s*\([0-9]{4}\)/;let a=(e=e.replace(/_/g," ")).match(t);a&&(a=a[0].trim(),e=e.replace(t,"").trim());const[,,n,o,,s,i]=e.match(/(^(-?\d+)([,\.\-\s]))?((.*?)\s+-\s+)?(.*)/);return{album:a,artist:s,title:i,duration:","==o?mo(n):""}},co=e=>(B&&!Qn(e)&&(e.startsWith(H)&&(e=e.slice(9)),e=H+Hn(e)),e),uo=e=>sn.children.length,fo=(e=2)=>Math.random()*e|0,po=e=>{const t=new RegExp(`^${H}`);return so(qn(e.replace(t,"")))},ho=e=>{un?(0,M.hZ)(Oe,e):cn!=mt&&rs(Oe,e)},mo=e=>{if(e==1/0||-1==e)return"LIVE";let t="",a="";return e>=3600&&(t=(e/3600|0)+":",e%=3600,a="0"),t+=(a+(e/60|0)).slice(-2)+":"+("0"+(e%60|0)).slice(-2),t},bo=(e,t,a,n=1)=>{e.min=t,e.max=a,e.step=n};function go(e,t=!1){const a=e.map((e=>ko(e,t)));Promise.all(a).then((e=>{const t=e.reduce(((e,t)=>e+t),0),a=`${t} song${t>1?"s":""} added to the queue${uo()<G?"":". Queue is full!"}`;F().alert({text:a,time:5}),Cs(!0)}))}function vo(e,t){const a=t.dataset,n=e.dataset,o=e.common,s=e.format;if(n)Object.assign(a,n);else if(a.artist=o.artist||a.artist,a.title=o.title||a.title,a.album=o.album?o.album+(o.year?" ("+o.year+")":""):a.album,a.codec=s?s.codec||s.container:a.codec,s&&(s.bitsPerSample||s.sampleRate&&!s.bitrate)?a.quality=(s.sampleRate?(s.sampleRate/1e3|0)+"KHz":"")+(s.sampleRate&&s.bitsPerSample?" / ":"")+(s.bitsPerSample?s.bitsPerSample+"bits":""):s&&s.bitrate?a.quality=(s.bitrate/1e3|0)+"K "+(s.codecProfile||""):a.quality="",s&&s.duration?a.duration=mo(s.duration):a.duration="",o.picture&&o.picture.length){const e=new Blob([o.picture[0].data],{type:o.picture[0].format});a.cover=URL.createObjectURL(e)}t==$n[Qa]&&hs()}function yo(e,t){return new Promise((a=>{if(uo()>=G)return void a(0);const{fileName:n,baseName:o,extension:s}=lo(function(e){return e.replace(/%2[356]/g,(e=>({"%23":"#","%25":"%","%26":"&"}[e])))}(e.file)),i=so(e.file),l=document.createElement("li"),r=l.dataset;Object.assign(r,ce),t||(t=ro(o)),r.album=t.album||"",r.artist=t.artist||"",r.title=t.title||n||i.slice(i.lastIndexOf("//")+2),r.duration=t.duration||"",r.codec=t.codec||s.toUpperCase(),r.file=i,l.handle=e.handle,sn.appendChild(l),!be.includes(s)&&s||(r.retrieve=1,ns()),1!=uo()||ao()?a(1):jo(0).then((()=>a(1))),ln>uo()-3&&Bo()}))}function ko(e,t=!1){let a;return a=ve.includes(lo(e.file).extension)?qo(e):yo(e),a.then((e=>{t&&!ao()&&e>0&&Go(uo()-e)})),a}function wo(e){let t=e?Nn((+At.dataset.value||0)+.1*e):0;t<-1?t=-1:t>1&&(t=1),fs(t),ps("Balance: "+(0==t?"CENTER":100*Math.abs(t)+"% "+(t>0?"Right":"Left"))),Ms()}function xo(e){const t=+Ut.value;(1==e&&t<+Ut.max||-1==e&&t>+Ut.min)&&(Ut.value=t+Ut.step*e,ys(Ut)),ps(`Analyzer height: ${Ut.value}%`)}function Lo(e){let t=Nn((+Da.dataset.value||0)+.05*e);t<0?t=0:t>1&&(t=1),ws(t),ps("Volume: "+20*t),Ms()}function So(e=Qa){const t=$n[e],a=t.dataset;_o(t,null),Object.assign(a,ce),t.load(),e==Qa&&hs()}function Eo(e=Va){const t=e.pixelRatio,a=ra.height=Dt.clientHeight*t,n=ra.width=Dt.clientWidth*t;hn=Math.max(12,Math.min(n,a)/[24,17,13.5][+ca.value]),mn=3*hn,bn=n/2,gn=n-hn,vn=1.4*hn,yn=1.8*vn,Ln=n/3-hn,kn=a-4*hn,wn=a-2.8*hn,xn=a-1.6*hn,Sn=n-8*hn,En=`bold ${.7*hn}px sans-serif`,Cn=`bold ${hn}px sans-serif`}function Co(e,t,a){const n=wt("#console-content"),o=new Date,s=o.toLocaleTimeString([],{hour12:!1})+"."+String(o.getMilliseconds()).padStart(3,"0");a&&(n.innerHTML=""),t&&wt("#toggle_console").classList.add("warning"),e&&(n.innerHTML+=`<div ${t?'class="error"':""}>${s} &gt; ${e}</div>`),n.scrollTop=n.scrollHeight}function $o(e,t){const a=Zn(e)?e.elements[e.dataset.prop]:e.options;let n=(Zn(e)?Array.from(a).findIndex((e=>e.checked)):e.selectedIndex)+(t?-1:1);n<0?n=a.length-1:n>=a.length&&(n=0),Zn(e)?a[n].checked=!0:e.selectedIndex=n,ys(e)}function Ao(e){for(;e.firstChild;)e.removeChild(e.firstChild)}function To(){Pn&&Pn.key&&(delete Ha[Pn.key],0===Object.keys(Ha).filter((e=>!Ha[e].disabled)).length&&(Ha[Object.keys(Ha)[0]].disabled=!1),Vo(),Jo(),ls(xe),ls(Ee),Pn=null,location.href="#config")}function Po(e,t){if(eo(fn[e]))return;const a=`User Preset #${e+1}`,n=fn[e].name?"<br>"+fn[e].name:"";t?(fn[e]={},rs(Le,fn),F().alert({text:`Deleted ${a}`})):F().confirm({text:`Do you really want to DELETE ${a}?${n}<br>THIS CANNOT BE UNDONE!`,submitText:"DELETE",submitCallback:()=>{Po(e,!0)},cancelCallback:()=>{F().alert({text:"Canceled!"})}})}function Io(e=1){const t=$n[Qa];if(t.duration>0&&t.duration<1/0){let a=t.currentTime+5*e;a<0?a=0:a>t.duration-1&&(a=t.duration-1),ps(1),t.currentTime=a}"m"==On&&ds("m",e)}function Oo(){return clearTimeout(en),!!On&&(On=!1,!0)}async function Ro(){to()&&await document.exitPictureInPicture(),Va.toggleFullscreen(),document.activeElement.blur()}function Mo(e){if("F1"==e.code&&!e.altKey&&!e.ctrlKey)return location.href="#help",void e.preventDefault();if("BODY"!=e.target.tagName||e.altKey||e.ctrlKey)return;const t=e.shiftKey;if("keydown"==e.type)switch(e.code){case"ArrowUp":t?xo(1):Lo(1);break;case"ArrowDown":t?xo(-1):Lo(-1);break;case"ArrowLeft":t?wo(-1):On?(ps("Rewind",1),Io(-1)):ds("k",-1);break;case"ArrowRight":t?wo(1):On?(ps("Fast forward",1),Io()):ds("k");break;default:return}else if(e.code.match(/^(Digit|Numpad)[0-9]$/)){const a=e.code.slice(-1)-1;if(-1==a)t||(Qo(!0),ys(pa,!1));else if(t){const e=Wn();e.randomMode=0,cs(a,e)}else Ho(a)}else switch(e.code){case"Delete":case"Backspace":sn.querySelectorAll(".selected").forEach((e=>{os(e),e.remove()}));const e=jn(sn.querySelector(".current"));void 0!==e?ln=e:ln>uo()-1?ln=uo()-1:ln--,uo()?Bo():(So(nn),ao()||So()),Cs(!0);break;case"Space":ps(ao()?"Pause":"Play",1),Wo();break;case"ArrowLeft":case"KeyJ":Oo()||t||(ps("Previous track",1),Ss(!0));break;case"KeyG":$o(zt,t),ps(Xn());break;case"ArrowRight":case"KeyK":Oo()||t||(ps("Next track",1),Ss());break;case"KeyA":$o(pa,t),ps("Randomize: "+Un(pa)),ys(pa);break;case"KeyB":$o(t?It:$t);const a=$t.value[0];ps("Background: "+Un($t)+(a>1&&a<7?` (${Un(It)})`:""));break;case"KeyC":fa.click(),ps("Radial "+io(fa));break;case"KeyD":Ps();break;case"KeyE":uo()>0&&(Ls(),ps("Shuffle"));break;case"KeyF":Ro();break;case"KeyH":Nt.click();break;case"KeyI":$a.click(),ps("Song info display "+io($a));break;case"KeyL":Gt.click(),ps("LED effect "+io(Gt));break;case"KeyM":case"KeyV":$o(na,t),ps("Mode: "+Un(na));break;case"KeyN":$o(La,t),ps(Un(La).toUpperCase()+" sensitivity");break;case"KeyO":Zt.click(),ps((no(Zt)?"LOW":"HIGH")+" Resolution");break;case"KeyP":Ca.click(),ps("Peaks "+io(Ca));break;case"KeyR":ga.click(),ps("Queue repeat "+io(ga));break;case"KeyS":ps("Scale: "+["None","Frequency (Hz)","Level (dB)","Both"][function(e){let t=+wa.dataset.active+(xa.dataset.active<<1)+(e?-1:1);return t<0?t=3:t>3&&(t=0),wa.dataset.active=1&t,xa.dataset.active=t>>1,ys([wa,xa]),t}(t)]);break;case"KeyT":sa.click(),ps((no(sa)?"Flat":"Shadowed")+" text mode");break;case"KeyU":Qt.click(),ps("Luminance bars "+io(Qt));break;case"KeyX":$o(ba,t),ps("Reflex: "+Un(ba));break;default:return}e.preventDefault()}function _o(e,t){const a=e.src||"";Vn(a)&&URL.revokeObjectURL(a),t?e.src=t:e.removeAttribute("src"),vs()}function Do(e,t,a){return new Promise((n=>{const o=URL.createObjectURL(e);_o(t,o),t.onloadeddata=()=>{a&&t.play(),t.onloadeddata=null,n(o)}}))}async function Fo(e){return JSON.parse(B?await electron.api("storage-get",e):localStorage.getItem(e))}async function Bo(){const e=ln<uo()-1?ln+1:0,t=sn.children[e],a=$n[nn];t&&(vo(t,a),t.handle?(await t.handle.requestPermission(),t.handle.getFile().then((e=>Do(e,a))).then((()=>a.load()))):(_o(a,t.dataset.file),a.load())),Mn=!1}function qo(e){let t=so(e.file);return new Promise((async a=>{let n=[];const o=()=>{Promise.all(n).then((e=>{const t=e.reduce(((e,t)=>e+t),0);a(t)}))},s=async e=>{let a,s;Vt.dataset.path||gs(t),t=lo(t).path;for(let o of e.split(/[\r\n]+/))if("#"!=o.charAt(0)&&""!=o.trim()){let e;o=so(o),s||(s=lo(o).baseName),Qn(o)||(un&&(e=await T(o),e||Co(`Cannot resolve file handle for ${o}`,!0)),o=C(o),":"!=o[1]&&"/"!=o[0]&&(o=t+o)),n.push(yo({file:co(o),handle:e},{...ro(s),...a?{album:a}:{}})),s=""}else o.startsWith("#EXTINF")?s=o.slice(8):o.startsWith("#EXTALB")&&(a=o.slice(8));o()};if(t)if("string"==typeof t&&ve.includes(lo(t).extension))e.handle?e.handle.getFile().then((e=>e.text())).then(s).catch((e=>{Co(e,!0),a(0)})):fetch(t).then((e=>{if(200==e.status)return e.text();Co(`Fetch returned error code ${e.status} for URI ${t}`,!0)})).then(s).catch((e=>{Co(e,!0),a(0)}));else{const e=await(0,M.Jt)(!0===t?_e:Fe+t);Array.isArray(e)?(e.forEach((e=>{const{file:t,handle:a,content:o}=e;n.push(yo({file:t,handle:a},o))})),o()):(!0!==t&&Co(`Unrecognized playlist file: ${t}`,!0),a(0))}else a(-1)}))}function Ho(e,t=!0,a,n){const o=+e==e,s=o?fn[e].options:Gn(e),i=Gn("default");eo(s)||(t&&Co("Loading "+(o?"User Preset #"+(e+1):"'"+Yn(e)+"' preset")),void 0!==s.stereo&&(s.channelLayout=ja[+s.stereo][0]),xt("[data-prop]").forEach((e=>{const t=e.dataset.prop,o=void 0!==s[t]?s[t]:a?i[t]:void 0;if(void 0!==o&&(e!=pa||!n))if(Zn(e)){const t=e.querySelector(`[value="${o}"]`);t&&(t.checked=!0)}else e.classList.contains("switch")?e.dataset.active=+o:e==At?fs(o):e==oa?Os(o):e==Ta?ks(o):e==Da?ws(o):(e.value=o,-1==e.selectedIndex&&(e.selectedIndex=0),_s(e))})),Va.setOptions({alphaBars:no(Lt),ansiBands:no(Et),colorMode:zn(_t),fftSize:zn(qt),frequencyScale:zn(jt),ledBars:no(Gt),linearAmplitude:no(Yt),loRes:no(Zt),lumiBars:no(Qt),maxFPS:zn(ea),maxFreq:zn(ha),minFreq:zn(ma),mirror:zn(aa),noteLabels:no(ia),outlineBars:no(la),radial:no(fa),roundBars:no(va),showFPS:no(Nt),showPeaks:no(Ca),showScaleX:no(wa),showScaleY:no(xa),smoothing:zn(Aa),spinSpeed:zn(Pa),splitGradient:no(Ia),weightingFilter:zn(Ba)}),ys([$t,It,Pt,Mt,Ut,Jt,La,ba,zt,Wt,...n?[]:[pa],Tt,na]),"demo"==e&&Qo(!0),t&&F().alert({text:"Settings loaded!"}))}async function No(e){Ao(ua);const t=new Option("Select a playlist","");t.disabled=!0,t.selected=!0,ua.options[ua.options.length]=t;let a=await(0,M.Jt)(Me);const n=await Fo(Me);if(n){for(const e of Object.keys(n)){const t=Fe+e,o=await Fo(t);let s=[];for(const e of o)s.push({file:e});await(0,M.hZ)(t,s),es(t),a[e]=n[e]}await(0,M.hZ)(Me,a),es(Me)}if(a)for(const t of Object.keys(a)){const n=new Option(a[t],t);n.dataset.isLocal="1",t==e&&(n.selected=!0),ua.options[ua.options.length]=n}fetch("playlists.cfg").then((e=>200==e.status&&(Co("Found legacy playlists.cfg file"),e.text()))).then((e=>{if(!1!==e){let t=0;e.split(/[\r\n]+/).forEach((e=>{if("#"!=e.charAt(0)&&""!=e.trim()){let a=e.split(/\|/);2==a.length&&(ua.options[ua.options.length]=new Option(a[0].trim(),a[1].trim()),t++)}})),t?Co(`${t} playlists loaded from playlists.cfg`):Co("No playlists found in playlists.cfg",!0)}})).catch((e=>{}))}function jo(e,t){return new Promise((async a=>{const n=$n[Qa],o=()=>{Is(),Bo(),a(!0)};if(sn.children[e]){ln=e;const a=sn.children[ln];vo(a,n),a.handle?(await a.handle.requestPermission(),a.handle.getFile().then((e=>Do(e,n,t))).then((()=>o()))):(_o(n,a.dataset.file),n.onloadeddata=()=>{t&&n.play(),n.onloadeddata=null,o()})}else a(!1)}))}function Uo(){Pn={name:"New Gradient",bgColor:"#111111",colorStops:[{pos:.1,color:"#222222"},{pos:1,color:"#eeeeee"}],disabled:!1,key:"custom-gradient-1"};let e=2;for(;Object.keys(Ha).some((e=>e===Pn.key))&&e<10;)Pn.key=`custom-gradient-${e}`,e++;ts(),wt("#btn-save-gradient").innerText="Add",wt("#btn-delete-gradient").style.display="none",location.href="#gradient-editor"}function zo(e){if(Mn||Ta.checked||ln>uo()-1)return!0;if(Mn=!0,ln<uo()-1)ln++;else{if(!no(ga))return Mn=!1,!1;ln=0}return e|=ao(),[Qa,nn]=[nn,Qa],vs(),hs(),e?$n[Qa].play().then((()=>Bo())).catch((e=>{e.code!=me&&(Co(e,!0),Bo(),zo(!0))})):Bo(),Is(),!0}function Wo(e){Ta.checked||(ao()&&!e?($n[Qa].pause(),to()&&Bn.pause()):$n[Qa].play().catch((e=>{e.code!=me&&(Co(e,!0),zo(!0))})))}function Ko(){let e=!0;return ao()?$n[Qa].currentTime>2?$n[Qa].currentTime=0:ln>0?Go(ln-1):e=!1:e=jo(ln-1),e}function Go(e){jo(e,!0)}function Yo(){let e=[{value:J,text:"Album cover"},{value:X,text:"Black"},{value:Y,text:"Gradient default"}];const t=e.length,a=An.length,n=Tn.length;e=[...e,...An.map(((e,t)=>({value:V+e.name,text:"🖼️ "+e.name,idx:t}))),...Tn.map(((e,t)=>({value:Z+e.name,text:"🎬 "+e.name,idx:t})))].slice(0,t+ +Rt.value),n&&e.splice(t,0,{value:Z,text:"Random video"}),a&&e.splice(t,0,{value:V,text:"Random image"}),Zo($t,e)}function Xo(e,t){const a=!Array.isArray(t[0]);for(const n of a?t.filter((e=>!e.disabled)):t){const t=e.dataset.prop,a=n.text||n[1],o=n.value||n[0],s=t+"-"+o,i=document.createElement("input"),l=document.createElement("label");i.name=t,i.id=s,i.type="radio",i.value=o,l.htmlFor=s,l.innerText=a,e.append(i,l)}}function Jo(){const e=wt("#enabled_gradients");Ao(e),Object.keys(Ha).forEach((t=>{t.startsWith("custom")?e.innerHTML+=`<label>\n\t\t\t       <input type="checkbox" class="enabledGradient" data-grad="${t}" ${Ha[t].disabled?"":"checked"}>\n                   <a href="#" data-grad="${t}" class="grad-edit-link">${Ha[t].name}</a>\n                </label>`:e.innerHTML+=`<label>\n\t\t\t       <input type="checkbox" class="enabledGradient" data-grad="${t}" ${Ha[t].disabled?"":"checked"}>\n                   ${Ha[t].name}\n                </label>`})),xt(".enabledGradient").forEach((e=>{e.addEventListener("click",(t=>{if(!e.checked&&Object.keys(Ha).reduce(((e,t)=>e+!Ha[t].disabled),0)<2)return F().alert({text:"At least one Gradient must be enabled!"}),t.preventDefault(),!1;Ha[e.dataset.grad].disabled=!e.checked,Vo(),ls(Ee)}))})),xt(".grad-edit-link").forEach((e=>{e.addEventListener("click",(e=>{e.preventDefault(),function(e){if(!Ha[e])throw new Error(`gradients[${e}] is null or undefined.`);const t=Ha[e],a={};a.name=t.name,a.bgColor=t.bgColor,a.dir=t.dir,a.disabled=t.disabled,a.key=e,a.colorStops=[];for(const e of t.colorStops)a.colorStops.push({...e});Pn=a}(e.target.getAttribute("data-grad")),ts(),wt("#btn-save-gradient").innerText="Save",wt("#btn-delete-gradient").style.display="block",location.href="#gradient-editor"}))}))}function Vo(){for(const e of[zt,Wt]){let t=e.value;Ao(e);for(const t of Object.keys(Ha))Ha[t].disabled||(e.options[e.options.length]=new Option(Ha[t].name,t));""!==t&&(e.value=t,ys(e))}}function Zo(e,t){const a=e.value;Array.isArray(t)||(t=[t]),Ao(e);for(const a of t.filter((e=>e&&!e.disabled))){const t=new Option(a.text||a[1],a.value||a[0]);null===a[0]&&(t.disabled=!0),void 0!==a.idx&&(t.idx=a.idx),e[e.options.length]=t}""!==a&&(e.value=a,-1==e.selectedIndex&&(e.selectedIndex=0),ys(e))}function Qo(e=Ta.checked){if(!ao()&&!e)return;const t=e=>!Ua.find((t=>t.value==e)).disabled,a=(e,t=!0,a=(()=>!0))=>{let o=9;do{if(Zn(e)){const t=e.elements[e.dataset.prop];t[fo(t.length)].checked=!0}else if(void 0!==e.dataset.active)e.dataset.active=fo();else if(e.step){const{min:t,max:a,step:n}=e,o=fo((a-t)/n+1)*n+ +t;e.value=(10*o|0)/10,_s(e)}else e.selectedIndex=fo(e.options.length)}while(!a(zn(e))&&o--);t&&n.push(e)};let n=[];if(t(it)){const e=fn.map(((e,t)=>eo(e)?null:t)).filter((e=>null!==e)),t=e.length;t&&Ho(e[fo(t)],!1,!1,!0)}if(t(nt)&&a(na),t(We)&&a(Lt),t(Ke)&&a($t,!1),t(Ye)&&a(It),t(Xe)&&a(Mt,!0,(e=>e!=de)),t(Je)&&a(_t),t(st)&&a(Ca),t(Qe)&&a(Gt),t(tt)&&a(Qt,!0,(e=>!e||$t.value[0]<=1||!no(Gt))),t(et)&&a(Xt,!1),t(Ve)&&a(Ht,!1),t(Ge)&&a(Tt,!1),t(ot)&&a(la),t(ct)&&a(ba,!1,(e=>e!=ze||!no(Gt))),t(lt)&&a(fa),t(dt)&&a(va),t(rt)&&a(Pa),t(ut)&&a(Ia),t(at)&&a(aa),t(Ze))for(const e of[zt,...no(Jt)?[]:[Wt]])a(e);n.push($t,ba,na),ys(n)}function es(e){B?electron.api("storage-remove",e):localStorage.removeItem(e)}function ts(){if(null==Pn)throw new Error("Current gradient must be set before editing gradient");const e=wt("#grad-color-table");Ao(e),wt("#new-gradient-name").value=Pn.name,wt("#new-gradient-horizontal").checked="h"===Pn.dir;const t=wt("#grad-row-label-template").cloneNode(!0);t.removeAttribute("id"),e.appendChild(t),Pn.colorStops.forEach(((e,t)=>{!function(e,t){const a=wt("#grad-color-table"),n=wt("#grad-row-template").cloneNode(!0),o=n.querySelector(".grad-color-picker"),s=n.querySelector(".grad-color-value"),i=n.querySelector(".grad-color-stop"),l=n.querySelector(".grad-add-stop"),r=n.querySelector(".grad-remove-stop");o.value=t.color,s.value=t.color,i.value=t.pos,o.addEventListener("input",(t=>{s.value=t.target.value,Pn.colorStops[e].color=o.value})),s.addEventListener("input",(t=>{o.value=t.target.value,Pn.colorStops[e].color=o.value})),i.addEventListener("input",(t=>{Pn.colorStops[e].pos=parseFloat(t.target.value)})),l.addEventListener("click",(()=>{Pn.colorStops.splice(e+1,0,{pos:(()=>{if(e===Pn.colorStops.length-1){const e=Pn.colorStops[Pn.colorStops.length-1].pos;return Pn.colorStops[Pn.colorStops.length-1].pos=(Pn.colorStops[Pn.colorStops.length-2].pos+e)/2,e}return(Pn.colorStops[e].pos+Pn.colorStops[e+1].pos)/2})(),color:"#111111"}),ts()})),2===Pn.colorStops.length?r.setAttribute("disabled","true"):r.addEventListener("click",(()=>{Pn.colorStops.splice(e,1),ts()})),n.removeAttribute("id"),a.appendChild(n)}(t,Pn.colorStops[t])})),wt("#new-gradient-bkgd").value=Pn.bgColor}async function as(){const e=Ot.value,t=new RegExp("\\.("+ge.join("|")+")$","i"),a=new RegExp("\\.("+ye.join("|")+")$","i");if(An=[],Tn=[],e==ee)try{const e=await fetch(W),n=await e.text();for(const{url:e,file:o}of P(n)){const n=lo(o).baseName;t.test(o)?An.push({name:n,url:W+"/"+e}):a.test(o)&&Tn.push({name:n,url:W+"/"+e})}}catch(e){}else if(e==te){const e=await(0,M.Jt)(we);try{if(e)for await(const[n,o]of e.entries())if(o instanceof FileSystemFileHandle){const e=t.test(n),s=a.test(n);if(e||s){const t=await o.getFile(),a=URL.createObjectURL(t);e?An.push({name:n,url:a}):Tn.push({name:n,url:a})}}}catch(e){}}if(e!=Q){const e=An.length,t=Tn.length;Co("Found "+(e+t==0?"no media":e+" image files and "+t+" video")+" files in the backgrounds folder")}Yo()}async function ns(){if(_n>=K)return;const e=Array.from(sn.children).find((e=>e.dataset.retrieve));if(e){let t=e.dataset.file,a=!1;_n++,delete e.dataset.retrieve;e:{if(e.handle){if("granted"!=await e.handle.requestPermission())break e;t=URL.createObjectURL(await e.handle.getFile()),a=!0}try{const a=await R.WC(t,{skipPostHeaders:!0});a&&(vo(a,e),$s(e),e.handle||a.common.picture&&a.common.picture.length||function(e){return new Promise((t=>{const a=lo(e).path;if(cn==mt||Qn(e))t("");else if(void 0!==In[a])t(co(a+In[a]));else{const e=cn==ht?N+Hn(a):a;fetch(e).then((e=>200==e.status?e.text():null)).then((e=>{let n="";if(e)if(cn==ht)n=e;else{const t=I(e);t.cover&&(n=t.cover)}In[a]=n,t(co(a+n))}))}}))}(t).then((t=>{e.dataset.cover=t,$s(e)})))}catch(e){}a&&URL.revokeObjectURL(t)}_n--,ns()}}function os(e){const t=e.dataset.cover;Vn(t)&&URL.revokeObjectURL(t)}function ss(){null!==Pn&&(Ha[Pn.key]=Pn,Va.registerGradient(Pn.key,Pn),Vo(),Jo(),ls(xe),Pn=null,location.href="#config")}function is(e,t){if(0==uo())return void F().alert({text:"Queue is empty!"});if(!e)return void F().input({text:"Playlist will be saved to the current folder.<br>Enter filename:",submitText:"Save",submitCallback:e=>{e?is($(e,!0)):F().alert({text:"Canceled"})},cancelCallback:()=>{F().alert({text:"Canceled"})}});const a=[];sn.childNodes.forEach((e=>{const{file:t,artist:n,title:o,duration:s}=e.dataset;a.push({file:po(t),artist:n,title:o,duration:s})})),fetch(j+e,{method:t?"PUT":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:a})}).then((e=>200==e.status?e.json():{error:`Cannot save file (ERROR ${e.status})`})).then((({file:e,error:a})=>{const n=e?`${t?"Updated":"Saved as"} ${lo(e).fileName}`:a;F().alert({text:n}),gs(e),E(null,b.scrollTop)}))}function ls(e){const t=e=>e.map((({value:e,disabled:t})=>({value:e,disabled:t})));if(e&&e!=Ce||rs(Ce,t(Na)),e&&e!=Se||rs(Se,t(Ka)),e&&e!=Ee||rs(Ee,Object.keys(Ha).map((e=>({value:e,disabled:Ha[e].disabled})))),!e||e==xe){const e={};Object.keys(Ha).filter((e=>e.startsWith("custom"))).forEach((t=>e[t]=Ha[t])),rs(xe,e)}if(e&&e!=$e||rs($e,t(Ua)),!e||e==De){let e=[];for(const t of[0,1,2])e.push({min:wt(`.min-db[data-preset="${t}"]`).value,max:wt(`.max-db[data-preset="${t}"]`).value,boost:wt(`.linear-boost[data-preset="${t}"]`).value});rs(De,e)}if(!e||e==Ae){const e={info:Kt.value,track:Ma.value,end:Bt.value,covers:Ea.checked,count:Sa.checked};rs(Ae,e)}if(!e||e==Pe){const e={autoHide:Ct.checked,bgLocation:Ot.value,bgMaxItems:Rt.value,fftSize:qt.value,fsHeight:Ut.value,maxFPS:ea.value,pipRatio:da.value,saveDir:ya.checked,saveQueue:ka.checked,smoothing:Aa.value};rs(Pe,e)}}function rs(e,t){const a=JSON.stringify(t);B?electron.api("storage-set",e,a):localStorage.setItem(e,a)}function cs(e,t,a,n){const o=`User Preset #${e+1}`,s=fn[e].name||"",i=Va.isFullscreen;if(!eo(fn[e])&&!n&&Rn!==e)return void(i?(ps(`Overwrite ${o} - Press again to confirm!`,5),Rn=e,setTimeout((()=>{Rn===e&&(Rn=!1)}),5e3)):F().confirm({text:`Do you really want to overwrite ${o}?<br>${s}`,submitText:"Overwrite",submitCallback:()=>{cs(e,t,a,!0)},cancelCallback:()=>{F().alert({text:"Canceled!"})}}));if(Rn=!1,!a||!`${a}`.trim()){if(!i)return void F().input({text:"Give this preset a name or short description",submitText:"Save",value:s,maxlength:40,submitCallback:a=>{cs(e,t,a.trim()||je,!0)},cancelCallback:()=>{F().alert({text:"Save canceled!"})}});a=""}a==je&&(a=""),fn[e]={name:a,options:t},rs(Le,fn);const l=`Saved to ${o}`;i?ps(l,5):F().alert({text:l})}function ds(e,t=1){en=setTimeout((()=>{On=e,Io(t)}),200)}function us(e){document.documentElement.style.setProperty("--background-image",e?`url('${e.replace(/['()]/g,"\\$&")}')`:"none")}function fs(e){At.dataset.value=e,on&&(on.pan.value=Math.log10(9*Math.abs(e)+1)*Math.sign(e)),At.querySelector(".marker").style.transform=`rotate( ${145*e-90}deg )`}function ps(e,t=2,a=-1){if(e){const n=performance.now(),o=n+1e3*t;e==+e?(Za.info=e,Za.startTime=n,Za.endTime=Math.max(o,Za.endTime||0),Za.fade=t==1/0?0:t/3*a):(Za.msg=e,2==Za.info&&(Za.info=1),Za.msgTimer=o)}else Za={endTime:0,msgTimer:0}}function hs(){Fn.src=$n[Qa].dataset.cover,$t.value==J&&us(Fn.src)}function ms(e){Ct.checked=e.autoHide,Ot.value=e.bgLocation,Rt.value=e.bgMaxItems,qt.value=e.fftSize,Ut.value=e.fsHeight,ea.value=e.maxFPS,ca.value=e.osdFontSize,da.value=e.pipRatio,ya.checked=e.saveDir,ka.checked=e.saveQueue,Aa.value=e.smoothing}function bs(e){Kt.value=e.info,Ma.value=e.track,Bt.value=e.end,Ea.checked=e.covers,Sa.checked=e.count}function gs(e=""){B&&(e=po(e),Vt.dataset.path=Hn(e),Vt.innerText=lo(e).fileName,Vt.title=qn(e,!0))}function vs(){const e=$t.value[0],t=oo(),a=t||e!=Y&&e!=X;for(const e of $n)e.style.display=t&&e==$n[Qa]?"":"none";return Va.overlay=a,Va.showBgColor=!t&&e==Y,Dt.style.backgroundImage=t?"none":"var(--background-image)",_a.style.display=t||e!=Z?"none":"",a}function ys(e,t=!0){Array.isArray(e)||(e=[e]);const a=()=>Wt.style.display=zn(Mt)==ue||no(Jt)?"none":"";for(const n of e){switch(n){case Lt:Va.alphaBars=no(Lt);break;case Et:Va.ansiBands=no(Et);break;case Ct:Ts(!0);break;case $t:const e=$t.value[0],o=$t[$t.selectedIndex].idx,s=vs();if(e==Z){us();const e=Tn[void 0===o?fo(Tn.length):o].url;try{decodeURIComponent(_a.src).endsWith(decodeURIComponent(e))||(_a.src=e)}catch(t){_a.src=e}}else s?us(e==J?Fn.src:An[void 0===o?fo(An.length):o].url):us();break;case Tt:Va.barSpace=Va.isLumiBars?1.5:zn(Tt);break;case It:const i=It.value,l=i==ie||i==le||i==re;Dt.classList.toggle("repeat",i==oe),Dt.classList.toggle("cover",i==ae||l),Dt.style.backgroundSize="",Fa.style.display=l?"":"none",Fa.classList.toggle("rotating",i==re),Fa.classList.toggle("paused",i==ie);break;case Pt:Ft.style.background=`rgba(0,0,0,${1-Pt.value})`;break;case Ot:Ot.value==te?window.showDirectoryPicker({startIn:"pictures"}).then((e=>{(0,M.hZ)(we,e)})).catch((e=>{Ot.value=Q,(0,M.yH)(we)})).finally((()=>as())):((0,M.yH)(we),as());break;case Rt:Yo();break;case Mt:Va.channelLayout=zn(Mt),a();break;case _t:Va.colorMode=zn(_t);break;case Ht:Va.fillAlpha=na.value==Be?1:Ht.value;break;case qt:Va.fftSize=qt.value,Co("FFT size is "+Va.fftSize+" samples");break;case Nt:Va.showFPS=no(Nt);break;case jt:Va.frequencyScale=zn(jt);break;case Ut:St.style.height=`${Ut.value}%`;break;case zt:case Wt:""===n.value&&(n.selectedIndex=0),no(Jt)?Va.gradient=zt.value=Wt.value=n.value:Va[n==zt?"gradientLeft":"gradientRight"]=n.value;break;case Gt:Va.ledBars=no(Gt);break;case Yt:Va.linearAmplitude=no(Yt);break;case Xt:Va.lineWidth=na.value==Be?0:Xt.value;break;case Jt:a(),no(Jt)&&ys(zt,!1);break;case Zt:Va.loRes=no(Zt);break;case Qt:Va.lumiBars=no(Qt),ys(Tt,!1);break;case ea:Va.maxFPS=ea.value;break;case aa:Va.mirror=zn(aa);break;case na:const r=na.value;[Be,qe].includes(r)?Va.mode=10:Va.mode=r,r==Be?(Va.lineWidth=0,Va.fillAlpha=1):(Va.lineWidth=Xt.value,Va.fillAlpha=Ht.value),ys(Tt,!1);break;case oa:Os();break;case ia:Va.noteLabels=no(ia);break;case ca:Eo();break;case la:Va.outlineBars=no(la);break;case da:to()&&(Va.width=Va.height*da.value);break;case fa:Va.radial=no(fa),ys(Tt,!1);break;case pa:const c=pa.value;rn&&(rn=clearInterval(rn)),c>1&&(rn=setInterval(Qo,2500*c));break;case ma:case ha:for(;+ha.value<=+ma.value;)ha.selectedIndex++;Va.setFreqRange(ma.value,ha.value);break;case ba:switch(zn(ba)){case Ue:Va.reflexRatio=.4,Va.reflexAlpha=.2;break;case ze:Va.reflexRatio=.5,Va.reflexAlpha=1;break;default:Va.reflexRatio=0}break;case va:Va.roundBars=no(va);break;case ya:ya.checked?ho(v):((0,M.yH)(Oe),es(Oe));break;case ka:ka.checked?Cs(!0):(0,M.yH)(_e);break;case wa:Va.showScaleX=no(wa);break;case xa:Va.showScaleY=no(xa);break;case La:const d=zn(La);Va.setSensitivity(wt(`.min-db[data-preset="${d}"]`).value,wt(`.max-db[data-preset="${d}"]`).value),Va.linearBoost=wt(`.linear-boost[data-preset="${d}"]`).value;break;case Ca:Va.showPeaks=no(Ca);break;case Aa:Va.smoothing=Aa.value,Co("smoothingTimeConstant is "+Va.smoothing);break;case Ta:const u=Ta.checked;t=!1,ks(u,(e=>{u&&e?(pn=oa.checked,Os(!0)):u||Os(!!pn),Ms()}));break;case Pa:Va.spinSpeed=Pa.value;break;case Ia:Va.splitGradient=no(Ia);break;case Ba:Va.weightingFilter=zn(Ba)}t&&(Ga.includes(n)?ls(Pe):Ms())}}async function ks(e,t){Ta.checked=e,e?B&&!await electron.api("ask-for-media-access")||!navigator.mediaDevices?(Co("Cannot access user microphone",!0),Ta.checked=!1,t&&t(!1)):navigator.mediaDevices.getUserMedia({audio:!0}).then((e=>{an=Va.audioCtx.createMediaStreamSource(e),ao()&&$n[Qa].pause(),Va.connectInput(an),Co("Audio source set to microphone")})).catch((e=>{Co(`Could not change audio source - ${e}`,!0),Ta.checked=!1})).finally((()=>{t&&t(Ta.checked)})):(an&&(Va.disconnectInput(an),an.mediaStream.getTracks()[0].stop(),an=null),Co("Audio source set to built-in player"),t&&t(!0))}function ws(e){Da.dataset.value=e,Va.volume=e**2.5,Da.querySelector(".marker").style.transform=`rotate( ${125+290*e}deg )`}function xs(){let e;Dt.addEventListener("mouseenter",(()=>{Ct.checked&&setTimeout((()=>{Dt.matches(":hover")&&Ts(!1)}),300)})),wt(".panel-area").addEventListener("mouseenter",(()=>Ts(!0))),Dt.addEventListener("transitionend",(()=>{Dt.style.height&&(ta.style.display="none"),document.body.style.overflowY=window.innerHeight<kt?"scroll":""})),Ra.addEventListener("click",(()=>{Ts(!0),Rs()})),wt(".settings-close").addEventListener("click",(()=>Rs())),Oa.addEventListener("click",(()=>{Ts(!0),As(),Oa.classList.remove("warning"),Co()})),wt("#console-close").addEventListener("click",(()=>As())),wt("#console-clear").addEventListener("click",(()=>Co("Console cleared.",!1,!0))),xt(".switch").forEach((e=>{e.addEventListener("click",(()=>{e.dataset.active=+!+e.dataset.active,ys(e)}))})),xt("[data-prop]").forEach((e=>{Zn(e)?e.elements[e.dataset.prop].forEach((t=>{t.addEventListener("click",(()=>ys(e)))})):e.addEventListener("change",(()=>{ys(e),_s(e)}))})),[Da,At].forEach((t=>{t.addEventListener("wheel",(a=>{if(a.preventDefault(),e)return;e=setTimeout((()=>e=!1),50);const n=Math.sign(a.deltaY||0);t==Da?Lo(n):wo(n)}))})),At.addEventListener("dblclick",(()=>{wo(0)})),wt("#btn_play").addEventListener("click",(()=>Wo())),wt("#btn_stop").addEventListener("click",Es),wt("#btn_shuf").addEventListener("click",Ls),wt("#btn_prev").addEventListener("mousedown",(()=>ds("m",-1))),wt("#btn_prev").addEventListener("click",(e=>{Oo()||Ss(!0)})),wt("#btn_next").addEventListener("mousedown",(()=>ds("m"))),wt("#btn_next").addEventListener("click",(()=>{Oo()||Ss()})),wt("#load_preset").addEventListener("click",(()=>{const e=[];qa.forEach((t=>{eo(t.options)||e.push({text:t.name+("default"==t.key?" (warning: resets Volume!)":""),handler:()=>Ho(t.key)})})),e.push({text:"<strong>USER PRESETS →</strong>",handler:()=>{const e=[];Jn().forEach(((t,a)=>{e.push({text:t,handler:()=>Ho(a)})})),F().select({text:"LOAD PRESET:",choices:e})}}),F().select({text:"LOAD PRESET:",choices:e})})),wt("#btn_save").addEventListener("click",(()=>{const e=[];Jn().forEach(((t,a)=>{const n=fn[a].options;e.push({type:1,text:t,handler:()=>cs(a,Wn())},{type:2,text:eo(n)?"":'<button title="Edit name">&#xf11f;</button>',handler:()=>cs(a,n,"",!0)},{type:2,text:eo(n)?"":'<button title="Delete preset">&#xf120;</button>',handler:()=>Po(a)})})),F().select({text:"<strong>Click slot to SAVE - Use buttons to Edit or Delete</strong>",choices:e})})),wt("#btn_fullscreen").addEventListener("click",Ro),wt("#save_playlist").addEventListener("click",(()=>{if(B){const e=Vt.dataset.path;e?F().confirm({text:`<strong>${Vt.innerText}</strong><br>will be overwritten with the current play queue<br>ARE YOU SURE?`,submitText:"Overwrite",submitCallback:()=>is(e,!0),cancelCallback:()=>F().alert({text:"Canceled"})}):is()}else e=ua.selectedIndex,""==ua[e].value?Cs():ua[e].dataset.isLocal?F().confirm({text:`Overwrite "${ua[e].innerText}" with the current play queue?`,submitText:"Overwrite",submitCallback:()=>{Cs(ua[e].value)},cancelCallback:()=>{F().alert({text:"Canceled"})}}):F().alert({text:'This is a server playlist which cannot be overwritten.<br>Click "Save as..." to create a new local playlist.',time:5});var e})),wt("#create_playlist").addEventListener("click",(()=>B?is():Cs())),wt("#btn_clear").addEventListener("click",(()=>{!function(){for(;sn.hasChildNodes();)os(sn.removeChild(sn.firstChild));ao()?ln=-1:(ln=0,So(Qa)),So(nn),Is()}(),gs(),Cs(!0)})),(B?wt(".playlist-bar"):Vt).style.display="none",B||(wt("#load_playlist").addEventListener("click",(()=>{qo({file:ua.value}).then((e=>{const t=-1==e?"No playlist selected":`${e} song${e>1?"s":""} added to the queue`;F().alert({text:t,time:5})}))})),wt("#delete_playlist").addEventListener("click",(()=>{return e=ua.selectedIndex,void(ua[e].dataset.isLocal?F().confirm({text:`Do you really want to DELETE the "${ua[e].innerText}" playlist?<br>THIS CANNOT BE UNDONE!`,submitText:"Delete",submitCallback:async()=>{const t=ua[e].value,a=Fe+t,n=await(0,M.Jt)(Me);n&&delete n[t],await(0,M.yH)(a),await(0,M.hZ)(Me,n),F().alert({text:"Playlist deleted"}),No()},cancelCallback:()=>{F().alert({text:"Canceled"})}}):ua[e].value&&F().alert({text:"Cannot delete a server playlist!"}));var e}))),ra.addEventListener("click",(()=>Ps()));const t=wt("#btn_toggle_filesystem"),a=()=>t.innerText="Switch to "+(un?"Server":"Device");(tn||un)&&dn?(a(),t.addEventListener("click",(async()=>{un=!un;const e=await(un?(0,M.Jt)(Oe):Fo(Oe));un&&e&&"granted"!=await e[0].handle.requestPermission()?un=!1:(L=!L,v=[],f=null,k=[L?r:o],O(e),a(),rs(Te,un))}))):t.style.display="none";const n=wt("#btn_add_selected"),s=wt("#btn_add_folder");B||tn||un?(n.addEventListener("mousedown",(()=>go(A(".selected")))),s.addEventListener("click",(()=>go(A())))):(n.style.display="none",s.style.display="none");const i=wt("#local_file");let l,c;B||dn?i.parentElement.style.display="none":i.addEventListener("change",(e=>function(e){const t=e.files[0];if(t){So();const e=$n[Qa];e.dataset.file=t.name,e.dataset.title=lo(t.name).baseName,Do(t,e,!0).then((e=>R.WC(e))).then((t=>vo(t,e))).catch((e=>{}))}}(e.target))),wt("#btn_load_url").addEventListener("click",(()=>{F().input({text:"Load audio file or stream from URL",submitText:"Load",submitCallback:e=>{e.trim()&&(ko({file:e},!0),Cs(!0))}})}));const d=wt("#btn_pip");document.pictureInPictureEnabled?d.addEventListener("click",(async()=>{if(Bn!==document.pictureInPictureElement){const e=Va.canvas.captureStream();l=e.getTracks()[0],Bn.muted=!0,Bn.srcObject=e,await Bn.play(),Bn.requestPictureInPicture()}else document.exitPictureInPicture()})):d.classList.add("disabled");const u=((e,t=300)=>{let a;return(...n)=>{clearTimeout(a),a=setTimeout((()=>e.apply(this,n)),t)}})((()=>Va.setCanvasSize(c.width,c.height)));Bn.addEventListener("enterpictureinpicture",(e=>{c=e.pictureInPictureWindow,Dt.classList.add("pip"),d.classList.add("active"),Va.setCanvasSize(c.height*da.value,c.height),c.addEventListener("resize",u)})),Bn.addEventListener("leavepictureinpicture",(()=>{c.removeEventListener("resize",u),Bn.pause(),l.stop(),Bn.srcObject=l=null,d.classList.remove("active"),Dt.classList.remove("pip"),Va.setCanvasSize()}));const p=navigator.mediaSession;p&&(p.setActionHandler("play",(()=>Wo())),p.setActionHandler("pause",(()=>Wo())),p.setActionHandler("previoustrack",(()=>Ko())),p.setActionHandler("nexttrack",(()=>zo()))),wt("#add-gradient").addEventListener("click",Uo),wt("#btn-save-gradient").addEventListener("click",ss),wt("#btn-delete-gradient").addEventListener("click",To),wt("#new-gradient-bkgd").addEventListener("input",(e=>{Pn.bgColor=e.target.value})),wt("#new-gradient-name").addEventListener("input",(e=>{Pn.name=e.target.value})),wt("#new-gradient-horizontal").addEventListener("input",(e=>{Pn.dir=e.target.checked?"h":void 0}))}function Ls(){for(let e=uo()-1;e>0;e--){const t=Math.random()*(e+1)|0,a=sn.replaceChild(sn.children[t],sn.children[e]);sn.insertBefore(a,sn.children[t])}Go(0),Cs(!0)}function Ss(e=!1){(e?Ko():zo())||ps(`Already at ${e?"first":"last"} track`)}function Es(){$n[Qa].pause(),ps(),jo(0)}async function Cs(e,t=!0){const a=1==e;if(!a||ka.checked)if(0!=uo()||a)if(e){let n=e;if(!a&&!t){n=n.normalize("NFD").replace(/[\u0300-\u036f]/g,""),n=n.toLowerCase().replace(/[^a-z0-9]/g,"_");let t=await(0,M.Jt)(Me)||{},a=0,o=n;for(;t.hasOwnProperty(n)&&a<100;)n=o+"_"+a,a++;t[n]=e,await(0,M.hZ)(Me,t),No(n)}let o=[];for(const e of sn.childNodes){const{album:t,artist:a,codec:n,duration:s,file:i,title:l}=e.dataset,{handle:r}=e;o.push({file:i,handle:r,content:{album:t,artist:a,codec:n,duration:s,title:l}})}a?(0,M.hZ)(_e,o):(0,M.hZ)(Fe+n,o).then((()=>F().alert({text:"Playlist saved!"})))}else F().input({text:"Give this playlist a name:",submitText:"Save",submitCallback:e=>{e&&Cs(e,!1)},cancelCallback:()=>{F().alert({text:"Canceled"})}});else F().alert({text:"Queue is empty!"})}function $s(e){for(const t of $n)t.dataset.file==e.dataset.file&&vo(e,t)}function As(e){wt("#console").classList.toggle("active",Oa.classList.toggle("active",e))}function Ts(e){window.innerHeight>=kt&&(document.body.style.overflowY="hidden"),e?ta.style.display="":(As(!1),Rs(!1)),Dt.style.height=e?"":"calc( 100vh - 160px )"}function Ps(){Za.endTime<performance.now()&&(Za.info=0),2==Za.info?ps():ps(1+(0|Za.info),+Kt.value||1/0)}function Is(){const e=sn.querySelector(".current"),t=sn.children[ln];e&&e.classList.remove("current"),t&&(t.classList.add("current"),t.scrollIntoViewIfNeeded())}function Os(e){void 0!==e?oa.checked=e:e=oa.checked,e?Va.disconnectOutput():Va.connectOutput()}function Rs(e){wt("#settings").classList.toggle("active",Ra.classList.toggle("active",e))}function Ms(){rs(Ie,{...Wn(),balance:At.dataset.value,micSource:Ta.checked,mute:oa.checked,volume:Da.dataset.value})}function _s(e){const t=e.previousElementSibling;t&&"value"==t.className&&(t.innerText=e.value)}!async function(){const e=e=>{zo(!0)||(jo(0),ps("Queue ended",10),to()&&Bn.pause())},t=e=>{e.target.attributes.src&&Co("Error loading "+e.target.src,!0)},a=e=>{$n[Qa].attributes.src?(to()&&Bn.play(),$n[Qa].currentTime<.1&&"1"==pa.value&&Qo(!0),no($a)&&ps(1,+Ma.value||1/0)):Go(ln)};window.addEventListener("error",(e=>Co(`Unexpected ${e.error}`,!0)));let c=!1;Co(`audioMotion v${z} initializing...`),Co(`User agent: ${navigator.userAgent}`),wt("#version").innerText=z;const d=await Fo(Re),C=wt("#update-banner");let A;null!=d&&d!=z||C.remove(),d!=z&&(rs(Re,z),null!=d&&(C.classList.add(vt),C.addEventListener("click",(()=>C.classList.remove(vt))),setTimeout((()=>{C.classList.remove(vt)}),1e4)));try{A=await fetch(bt)}catch(e){}let T=A&&200==A.status?await A.text():null;try{T=JSON.parse(T)}catch(e){Co(`Error parsing ${bt} - ${e}`,!0),T={}}T={...gt,...T},dn=T.enableLocalAccess&&!!window.showDirectoryPicker;const P=new URL(document.location).searchParams,I=P.get("mode"),R=P.get("mediaPanel");let D=T.enableLocalAccess&&(I==ke||"server"!=I&&await Fo(Te));null===D&&(D=T.defaultAccessMode==ke),(R==He||T.mediaPanel==He&&R!=Ne)&&Ts(!1),B&&Co(`Reading user preferences from ${await electron.api("storage-info")}`);const q=await async function(){const e=(e,t)=>{Array.isArray(e)&&e.forEach((e=>{const{value:a,disabled:n}="object"==typeof e?e:{value:e,disabled:!0},o=Array.isArray(t)?t.find((e=>e.value==a)):t[a];o&&(o.disabled=n)}))},t=await Fo(Ie),a=null!==t;((e,t)=>{const a=Kn("last");-1!=a&&(qa[a].options=t)})(0,{...Gn("default"),...t}),fn=await Fo(Le)||[],Array.isArray(fn)||(fn=[{name:"Custom",options:fn}]);for(let e=0;e<9;e++)void 0===fn[e]?fn[e]={}:eo(fn[e])||fn[e].options||(fn[e]={options:fn[e]});e(await Fo(Ce),Na),e(await Fo(Se),Ka);const n=await Fo(xe);n&&Object.keys(n).forEach((e=>{Ha[e]=n[e]})),e(await Fo(Ee),Ha),e(await Fo($e),Ua);const o=xt(".min-db");o.forEach((e=>bo(e,-120,-60)));const s=xt(".max-db");s.forEach((e=>bo(e,-50,0)));const i=xt(".linear-boost");i.forEach((e=>bo(e,1,5,.2))),(await Fo(De)||za).forEach(((e,t)=>{o[t].value=e.min,s[t].value=e.max,i[t].value=e.boost||za[t].boost})),bs({...Wa,...await Fo(Ae)||{}});for(let e=10;e<16;e++)qt[qt.options.length]=new Option(2**e);return bo(Aa,0,.9,.1),Zo(da,Ja),bo(Ut,25,100,5),Zo(ea,Xa),Zo(Ot,[[Q,"Disable"],[ee,"Built-in"],[...dn?[te,"Local folder"]:[]]]),bo(Rt,0,100),Zo(ca,[["0","Small"],["1","Medium"],["2","Large"]]),ms({...Ya,...await Fo(Pe)||{}}),a}();sn=wt("#playlist"),sn.addEventListener("dblclick",(e=>{e.target&&e.target.dataset.file&&(Go(jn(e.target)),e.target.classList.remove("selected","sortable-chosen"))})),ln=0,_.Ay.create(sn,{animation:150,group:{name:"filelist",pull:!1,put:!0},multiDrag:!0,multiDragKey:"ctrl",selectedClass:"selected",onEnd:e=>{ln=jn(sn.querySelector(".current")),0!=e.newIndex||ao()||jo(0),Bo(),Cs(!0)}}),Co(`Instantiating audioMotion-analyzer v${n.A.version}`),Va=new n.A(St,{fsElement:Dt,onCanvasDraw:(e,t)=>{if(!$n.length)return;const a=$n[Qa],n=a.dataset,o=a.duration-a.currentTime,s=+Bt.value,i=$t.value[0],l=It.value,r=no(sa),c=e.pixelRatio,{timestamp:d}=t;if(o<.1&&zo(!0),s>0&&o<=s&&no($a)&&d>Za.endTime&&ao()&&ps(1,o,1),!(l!=se&&"4"!=l&&"5"!=l||i!=J&&i!=V)){let t;if(l==se)t=(70*e.getEnergy()|0)-25;else{const e=a.currentTime/a.duration;t=100*("4"==l?e:1-e)}Dt.style.backgroundSize=`auto ${100+t}%`}ra.width|=0;const{endTime:u,startTime:f,msgTimer:p,info:h,msg:m,fade:b}=Za;if(d>u&&d>p)return;const g=(e,t,a,n)=>{r?(Dn.strokeText(e,t,a,n),Dn.fillText(e,t,a,n)):(Dn.shadowOffsetX=Dn.shadowOffsetY=3*c,Dn.fillText(e,t,a,n),Dn.shadowOffsetX=Dn.shadowOffsetY=0)};if(Dn.lineWidth=4*c,Dn.lineJoin="round",Dn.font=En,Dn.textAlign="center",Dn.fillStyle="#fff",Dn.strokeStyle=Dn.shadowColor="#000",p>d&&(d>u||2!=h)){const e=(p-d)/1e3;Dn.globalAlpha=e>1?1:e,g(Za.msg,bn,vn)}if(u>d){if(b<0){const e=(u-d)/1e3;Dn.globalAlpha=e>-b?1:e/-b}else{const e=Math.max(0,(d-f)/1e3);Dn.globalAlpha=e>b?1:e/b}if(2==Za.info&&(g(Xn(),bn,vn,Ln),Dn.textAlign="left",g(Un(na),hn,vn,Ln),g(`Randomize: ${Un(pa)}`,hn,yn,Ln),Dn.textAlign="right",g(Un(La).toUpperCase()+" sensitivity",gn,vn,Ln),g(`Repeat is ${io(ga)}`,gn,yn,Ln)),Ta.checked)Dn.textAlign="left",Dn.font=Cn,g("MIC source",hn,wn,Sn);else{Dn.textAlign="right",g(n.codec,gn,kn),g(n.quality,gn,kn+hn);const e=uo();e&&Sa.checked&&g(`Track ${ln+1} of ${e}`,gn,kn-hn),Dn.textAlign="left",g(n.artist.toUpperCase(),hn,kn,Sn),Dn.font=`italic ${En}`,g(n.album,hn,xn,Sn),Dn.font=Cn,g(a.src?n.title:"No song loaded",hn,wn,Sn),(a.duration||n.duration)&&(n.duration||(n.duration=mo(a.duration),sn.children[ln]&&(sn.children[ln].dataset.duration=n.duration)),Dn.textAlign="right",g(mo(a.currentTime)+" / "+n.duration,gn,xn)),Fn.width&&Ea.checked&&Dn.drawImage(Fn,hn,kn-1.3*mn,mn,mn)}}},onCanvasResize:(e,t)=>{let a;switch(Eo(t),e){case"create":Co(`Display resolution: ${t.fsWidth} x ${t.fsHeight} px (pixelRatio: ${window.devicePixelRatio})`),a="Canvas created";break;case"lores":a=`Lo-res ${t.loRes?"ON":"OFF"} (pixelRatio = ${t.dPR})`;break;case"fschange":a=(t.isFullscreen?"Enter":"Exit")+"ed fullscreen";break;case"user":a=(to()?"Resized for":"Closed")+" PIP";break;default:return}Co(`${a||e}. Canvas size is ${t.canvas.width} x ${t.canvas.height} px`)}});const H=Va.audioCtx;H.createStereoPanner&&(on=H.createStereoPanner(),Va.connectInput(on)),Qa=0,nn=1;for(const n of[0,1])$n[n]=wt(`#player${n}`),So(n),$n[n].addEventListener("play",a),$n[n].addEventListener("ended",e),$n[n].addEventListener("error",t),on?H.createMediaElementSource($n[n]).connect(on):Va.connectInput($n[n]);!function(){const e=(e,t,a,n,o)=>{a.forEach((a=>{e.innerHTML+=`<label><input type="checkbox" class="${t}" data-option="${a.value}" ${a.disabled?"":"checked"}> ${a.text}</label>`})),xt(`.${t}`).forEach((e=>{e.addEventListener("click",(t=>{if(!e.checked&&a.filter((e=>!e.disabled)).length<2)return F().alert({text:"At least one item must be enabled!"}),t.preventDefault(),!1;const s=a.find((t=>t.value==e.dataset.option));s&&(s.disabled=!e.checked,Zo(n,a),ls(o))}))}))};e(wt("#enabled_modes"),"enabledMode",Na,na,Ce),e(wt("#enabled_bgfit"),"enabledBgFit",Ka,It,Se);const t=wt("#enabled_gradients");Object.keys(Ha).forEach((e=>{t.innerHTML+=`<label><input type="checkbox" class="enabledGradient" data-grad="${e}" ${Ha[e].disabled?"":"checked"}> ${Ha[e].name}</label>`})),Jo();const a=wt("#random_properties");Ua.forEach((e=>{a.innerHTML+=`<label><input type="checkbox" class="randomProperty" value="${e.value}" ${e.disabled?"":"checked"}> ${e.text}</label>`})),xt(".randomProperty").forEach((e=>{e.addEventListener("click",(t=>{Ua.find((t=>t.value==e.value)).disabled=!e.checked,ls($e)}))})),xt("[data-preset]").forEach((e=>{"reset-sens"==e.className?e.addEventListener("click",(()=>{const t=e.dataset.preset;wt(`.min-db[data-preset="${t}"]`).value=za[t].min,wt(`.max-db[data-preset="${t}"]`).value=za[t].max,wt(`.linear-boost[data-preset="${t}"]`).value=za[t].boost,xt(`[data-preset="${t}"]`).forEach((e=>{e.classList.remove("field-error")})),e.dataset.preset==zn(La)&&ys(La,!1),ls(De)})):e.addEventListener("change",(()=>{const t=+e.value>=+e.min&&+e.value<=+e.max;t&&(e.dataset.preset==zn(La)&&ys(La,!1),ls(De)),e.classList.toggle("field-error",!t)}))}));for(const e of[Kt,Ma,Bt,Ea,Sa])e.addEventListener("change",(()=>ls(Ae)));wt("#reset_osd").addEventListener("click",(()=>{bs(Wa),ls(Ae)})),Ga.forEach((e=>{e.addEventListener("change",(()=>ys(e)))})),wt("#reset_general").addEventListener("click",(()=>{ms(Ya),ys(Ga)}))}(),Zo(na,Na);for(const e of[16,20,25,30,40,50,60,100,250,500,1e3,2e3])ma[ma.options.length]=new Option((e>=1e3?e/1e3+"k":e)+"Hz",e);for(const e of[1e3,2e3,4e3,8e3,12e3,16e3,2e4,22e3])ha[ha.options.length]=new Option(e/1e3+"kHz",e);Xo(Mt,ja),Xo(La,[["0","Low"],["1","Normal"],["2","High"]]),Xo(Tt,[["1.5","Min"],["0.1","10"],["0.25","25"],["0.5","50"],["0.75","75"]]),Zo(pa,[["0","OFF"],["1","On track change"],["2","5 seconds"],["6","15 seconds"],["12","30 seconds"],["24","1 minute"],["48","2 minutes"],["120","5 minutes"]]),Xo(ba,[["0","Off"],["1","On"],["2","Full"]]),Zo(It,Ka),Xo(aa,[["-1","Left"],["0","Off"],["1","Right"]]),Xo(jt,[[ft,"Bark"],["linear","Lin"],[pt,"Log"],["mel","Mel"]]),Xo(Ba,[["","OFF"],["A","A"],["B","B"],["C","C"],[yt,"D"],["468","468"]]),Xo(_t,[[fe,"Gradient"],[pe,"Index"],[he,"Level"]]),bo(Pt,.1,1,.1),bo(Xt,1,3,.5),bo(Ht,0,.5,.1),bo(Pa,0,3,1),ps(),Object.keys(Ha).forEach((e=>{const{bgColor:t,dir:a,colorStops:n}=Ha[e];n&&Va.registerGradient(e,{bgColor:t,dir:a,colorStops:n})})),Vo();const N=function(e,t={}){let a;var n;return m=document.createElement("ul"),m.className="breadcrumb",e.append(m),b=document.createElement("ul"),b.className="filelist",e.append(b),a=setTimeout((()=>{m.innerHTML="Waiting for server..."}),5e3),m.innerHTML="Initializing... please wait...",m.addEventListener("click",(async function(e){e.target&&"LI"==e.target.nodeName&&function(e){let t;for(;e>0;)t=v.pop(),e--;const a=v[v.length-1];a&&a.handle&&(f=a.handle,t=null),E(t,t&&t.scrollTop)}(e.target.dataset.depth)})),b.addEventListener("click",(async function(e){const t=e.target;if(t&&"LI"==t.nodeName)if("dir"==t.dataset.type)E(t.handle||t.dataset.path);else if("mount"==t.dataset.type)if(L)try{f=await window.showDirectoryPicker({startIn:"music"}),v=[],E(f)}catch(e){}else v=[],E(t.dataset.path)})),b.addEventListener("dblclick",(function(e){const t=e.target;t&&"LI"==t.nodeName&&p&&["file","list"].includes(t.dataset.type)&&p({file:$(t.dataset.path),handle:t.handle},e)})),"function"==typeof t.onDblClick&&(p=t.onDblClick),"function"==typeof t.onEnterDir&&(h=t.onEnterDir),t.fileExtensions&&(n=t.fileExtensions,y=new RegExp("\\.("+n.join("|")+")$","i")),new Promise((e=>{fetch("/serverInfo").then((e=>e.text())).then((async n=>{if(clearTimeout(a),n.startsWith("audioMotion")?(w=!0,g=1):g=u,1==g&&s){const e=await fetch("/getMounts");k=await e.json(),O(await async function(){const e=await fetch("/getHomeDir"),t=await e.text();let a=[];for(const e of t.split(i?"\\":"/"))a.push({dir:e,scrollTop:0});return a}())}else k=[t.rootPath||o],x=await E(k[0]),(t.forceFileSystemAPI&&l||!x)&&(v=[],l?(k=[r],L=!0):k=[],S());e({serverMode:g,useFileSystemAPI:L,hasServerMedia:x,filelist:b,serverSignature:g==u?"Standard web server":n})})).catch((t=>{clearTimeout(a),g=-1,l?(k=[r],L=!0):k=[],S(),e({serverMode:g,useFileSystemAPI:L,filelist:b})}))}))}(wt("#file_explorer"),{onDblClick:(e,t)=>{go([e],!0),t.target.classList.remove("selected","sortable-chosen")},onEnterDir:e=>{ya.checked&&c&&ho(e)},fileExtensions:[...be,...ve,...ye],forceFileSystemAPI:D}).then((e=>{cn=e.serverMode,tn=e.hasServerMedia,un=e.useFileSystemAPI;const{filelist:t,serverSignature:a}=e;cn!=mt&&Co(`${a} detected at ${U}`),tn||Co(cn==mt?"No server found":"Cannot access music directory on server",!0),un&&Co("Accessing files from local device via File System Access API."),!dn&&T.enableLocalAccess&&Co("No browser support for File System Access API. Cannot access files from local device.",D),B||(rs(Te,D&&dn),No()),(B||un||tn)&&_.Ay.create(t,{animation:150,draggable:'[data-type="file"], [data-type="list"]',group:{name:"filelist",pull:"clone",put:!1},multiDrag:!0,multiDragKey:"ctrl",selectedClass:"selected",sort:!1,onEnd:e=>{if("playlist"==e.to.id){let t=e.items.length?e.items:[e.item],a=[];t.forEach((e=>{a.push(ko({file:$(e.dataset.path),handle:e.handle})),e.remove()})),Promise.all(a).then((()=>Cs(!0)))}}}),xs()}));window.addEventListener("keydown",Mo),window.addEventListener("keyup",Mo),F().setOptions({positions:{alert:"bottom"}}),Promise.all([as(),N]).then((async()=>{const e=()=>{a&&O(a),ka.checked&&qo({file:!0})},t=async()=>{!(o&&"granted"!=await n.requestPermission()||s&&"granted"!=await a[0].handle.requestPermission())&&(ta.classList.remove("locked"),window.removeEventListener("click",t),o&&as(),e())},a=await(un?(0,M.Jt)(Oe):Fo(Oe)),n=await(0,M.Jt)(we),o=dn&&n&&"granted"!=await n.queryPermission(),s=un&&Array.isArray(a)&&a[0]&&"granted"!=await a[0].handle.queryPermission();Co(`Loading ${q?"last session":"default"} settings`),Ho("last",!1,!0),o||s?(ta.classList.add("locked"),window.addEventListener("click",t)):e(),Co(`AudioContext sample rate is ${H.sampleRate}Hz; Total latency is ${1e3*((H.outputLatency||0)+H.baseLatency)|0}ms`),Co("Initialization complete!"),c=!0}))}()},6216:()=>{Element.prototype.scrollIntoViewIfNeeded||(Element.prototype.scrollIntoViewIfNeeded=function(e){e=0===arguments.length||!!e;var t=this.parentNode,a=window.getComputedStyle(t,null),n=parseInt(a.getPropertyValue("border-top-width")),o=parseInt(a.getPropertyValue("border-left-width")),s=this.offsetTop-t.offsetTop<t.scrollTop,i=this.offsetTop-t.offsetTop+this.clientHeight-n>t.scrollTop+t.clientHeight,l=this.offsetLeft-t.offsetLeft<t.scrollLeft,r=this.offsetLeft-t.offsetLeft+this.clientWidth-o>t.scrollLeft+t.clientWidth,c=s&&!i;(s||i)&&e&&(t.scrollTop=this.offsetTop-t.offsetTop-t.clientHeight/2-n+this.clientHeight/2),(l||r)&&e&&(t.scrollLeft=this.offsetLeft-t.offsetLeft-t.clientWidth/2-o+this.clientWidth/2),(s||i||l||r)&&!e&&this.scrollIntoView(c)})},143:()=>{},3411:()=>{}},a={};function n(e){var o=a[e];if(void 0!==o)return o.exports;var s=a[e]={exports:{}};return t[e].call(s.exports,s,s.exports,n),s.exports}n.m=t,e=[],n.O=(t,a,o,s)=>{if(!a){var i=1/0;for(d=0;d<e.length;d++){for(var[a,o,s]=e[d],l=!0,r=0;r<a.length;r++)(!1&s||i>=s)&&Object.keys(n.O).every((e=>n.O[e](a[r])))?a.splice(r--,1):(l=!1,s<i&&(i=s));if(l){e.splice(d--,1);var c=o();void 0!==c&&(t=c)}}return t}s=s||0;for(var d=e.length;d>0&&e[d-1][2]>s;d--)e[d]=e[d-1];e[d]=[a,o,s]},n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var a in t)n.o(t,a)&&!n.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={792:0};n.O.j=t=>0===e[t];var t=(t,a)=>{var o,s,[i,l,r]=a,c=0;if(i.some((t=>0!==e[t]))){for(o in l)n.o(l,o)&&(n.m[o]=l[o]);if(r)var d=r(n)}for(t&&t(a);c<i.length;c++)s=i[c],n.o(e,s)&&e[s]&&e[s][0](),e[s]=0;return n.O(d)},a=self.webpackChunkaudioMotion=self.webpackChunkaudioMotion||[];a.forEach(t.bind(null,0)),a.push=t.bind(null,a.push.bind(a))})();var o=n.O(void 0,[96],(()=>n(6965)));o=n.O(o)})();